name: test actions
on:
  schedule:
    - cron: '30 6 * * *'  # Run daily at 7.30AM UTC
  workflow_dispatch:  # Allow manual triggering
  push:
    paths:
      - .github/workflows/test-PR.yml
    branches:
      - master

env:
  GIT_COMMIT_EMAIL: angelo.neacsu-bot@gmail.com
  GIT_COMMIT_NAME: Angelo Neacsu Bot
  BASE_BRANCH: master
  GH_TOKEN: ${{ secrets.PAT_FOR_PR_CREATION }}
jobs:
  test_job:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      id-token: write
      pull-requests: write
    # environment:
    #   name: main
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v3
        
      - name: Update Dockerfile and Create PR
        id: update-dockerfile
        run: |
          # Configure git
          git config --local user.email "angelo.neacsu-bot@gmail.com"
          git config --local user.name "Angelo Neacsu Bot"
          
          echo "# Create and checkout new branch"
          NEW_BRANCH="upgrade-java-$(date +'%Y%m%d%H%M%S')"
          git checkout -b $NEW_BRANCH
          
          echo "# Create dummy file"
          echo "test" > dummy
          
          echo "# Add dummy file"
          git add dummy
          
          echo "# Commit changes"
          git commit -m "Added dummy"
          
          echo "# Push the new branch"
          git push origin $NEW_BRANCH
          
          echo "# Create a pull request"
          gh pr create -B "master" -H "$NEW_BRANCH" --title "Merge $NEW_BRANCH into ${{ env.BASE_BRANCH }}" --body 'Created by Github action'
