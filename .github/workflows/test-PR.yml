name: test actions
on:
  schedule:
    - cron: '30 6 * * *'  # Run daily at 7.30AM UTC
  workflow_dispatch:  # Allow manual triggering
  push:
    paths:
      - .github/workflows/test-PR.yml
    branches:
      - master

env:
  GIT_COMMIT_EMAIL: angelo.neacsu-bot@gmail.com
  GIT_COMMIT_NAME: Angelo Neacsu Bot
  BASE_BRANCH: master
jobs:
  test_job:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      id-token: write
      pull-requests: write
    # environment:
    #   name: main
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v3
        
      - name: Update Dockerfile
        id: update-dockerfile
        run: |
          # Configure git
          git config --local user.email "${{ env.GIT_COMMIT_EMAIL }}"
          git config --local user.name "${{ env.GIT_COMMIT_NAME }}"

          # Create and checkout new branch
          NEW_BRANCH="upgrade-java-$(date +'%Y%m%d%H%M%S')"
          git checkout -b $NEW_BRANCH

          # Create dummy file
          echo "test" > dummy
          
          # Add dummy file
          git add dummy

          # Commit changes
          git commit -m "Added dummy"  # Remove leading comma and space

          # Push the new branch
          git push origin $NEW_BRANCH

          echo "NEW_BRANCH=$NEW_BRANCH" >> $GITHUB_OUTPUT
          
      - name: Create PR
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_FOR_PR_CREATION }}
          NEW_BRANCH: ${{ steps.update-dockerfile.outputs.NEW_BRANCH }}
        run: |-
          git pull
          gh pr create -B "${{ env.NEW_BRANCH }}" -H "${{ env.BASE_BRANCH }}" --title "Merge ${{ env.NEW_BRANCH }} into ${{ env.BASE_BRANCH }}" --body 'Created by Github action'
          
